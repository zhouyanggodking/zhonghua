/*! Built with http://stenciljs.com */
App.loadBundle("iaemuugg",["exports"],function(t){var e=window.App.h,o=function(){function t(){var t=this;this.minScale=1,this.maxScale=10,this.scaleStep=.05,this.rotate=0,this.naturalImgInfo={w:0,h:0},this.resize=function(){t.root&&(t.orientation=t.root.offsetWidth/t.root.offsetHeight>t.naturalImgInfo.w/t.naturalImgInfo.h,t.orientation?(t.translateLimit.y=0,t.translateLimit.x=(t.root.offsetWidth-t.root.offsetHeight/t.naturalImgInfo.h*t.naturalImgInfo.w)/2):(t.translateLimit.x=0,t.translateLimit.y=(t.root.offsetHeight-t.root.offsetWidth/t.naturalImgInfo.w*t.naturalImgInfo.h)/2),t.translateXY.x=0,t.translateXY.y=0,t._scale=1,t._root.firstElementChild.firstElementChild.style.transform="",t.watchfocusAreas(t.focusAreas))},this.lastXY={x:void 0,y:void 0},this.hold=!1,this.translateLimit={x:void 0,y:void 0},this.translateXY={x:0,y:0},this._scale=1,this.selectedX="100px",this.selectedY="200px",this.selectedWidth="200px",this.selectedHeight="200px",this.touchdistance=0,this.dragStartHandler=function(e){return t.hold=!0,e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),!1},this.dragEndHandler=function(e){return t.touch1th=null,t.touch2nd=null,t.firstCenter=null,t.touchdistance=0,t.hold=!1,t.lastXY={x:void 0,y:void 0},e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),!1},this.handleZoom=function(e){var o;if(e.wheelDelta>0)o=t._scale+t._scale*t.scaleStep>t.maxScale?t.maxScale-t._scale:t._scale*t.scaleStep;else{if(!(e.wheelDelta<0))return;o=t._scale-t._scale*t.scaleStep<t.minScale?t.minScale-t._scale:-t._scale*t.scaleStep}var a=(t._scale+o)*((e.offsetX-t.translateXY.x)/t._scale),s=(t._scale+o)*((e.offsetY-t.translateXY.y)/t._scale);t._scale+=o;var r=e.offsetX-a,i=e.offsetY-s,n=t.calcTranslate();r>n.xa?r=n.xa:r<n.xm&&(r=n.xm),i>n.ya?i=n.ya:i<n.ym&&(i=n.ym),t.translateXY.x=r,t.translateXY.y=i,t._focusAreas=[].concat(t._focusAreas),t.layer.style.transform="translate("+r+"px,"+i+"px) scale("+t._scale+")"},this.handleMousemove=function(e){if(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),t.hold){var o=void 0;if(window.TouchEvent){if(!(e instanceof TouchEvent)||e instanceof TouchEvent&&1==e.touches.length)o={offsetX:e instanceof TouchEvent?e.touches[0].clientX:e.offsetX,offsetY:e instanceof TouchEvent?e.touches[0].clientY:e.offsetY},t.touch1th=null,t.touch2nd=null,t.firstCenter=null,t.touchdistance=0;else if(null==t.touch2nd)t.touch1th=e.touches[0],t.touch2nd=e.touches[1],t.firstCenter={x:(e.touches[0].clientX+e.touches[1].clientX)/2,y:(e.touches[1].clientY+e.touches[1].clientY)/2},t.touchdistance=(e.touches[0].clientX-e.touches[1].clientX)*(e.touches[0].clientX-e.touches[1].clientX)+(e.touches[1].clientY-e.touches[1].clientY)*(e.touches[1].clientY-e.touches[1].clientY);else if(null!=t.touch2nd){t.touch1th=e.touches[0],t.touch2nd=e.touches[1];var a=(e.touches[0].clientX-e.touches[1].clientX)*(e.touches[0].clientX-e.touches[1].clientX)+(e.touches[1].clientY-e.touches[1].clientY)*(e.touches[1].clientY-e.touches[1].clientY),s={wheelDelta:a-t.touchdistance,offsetX:t.firstCenter.x,offsetY:t.firstCenter.y};return t.firstCenter={x:(e.touches[0].clientX+e.touches[1].clientX)/2,y:(e.touches[1].clientY+e.touches[1].clientY)/2},t.touchdistance=a,t.handleZoom(s),!1}}else o={offsetX:e.offsetX,offsetY:e.offsetY};var r=o.offsetX-(null==t.lastXY.x?o.offsetX:t.lastXY.x),i=o.offsetY-(null==t.lastXY.y?o.offsetY:t.lastXY.y);t.translateXY.x=t.translateXY.x+r,t.translateXY.y=t.translateXY.y+i;var n=t.calcTranslate();t.translateXY.x>n.xa&&r>0?t.translateXY.x=n.xa:t.translateXY.x<n.xm&&r<0&&(t.translateXY.x=n.xm),t.translateXY.y>n.ya&&i>0?t.translateXY.y=n.ya:t.translateXY.y<n.ym&&i<0&&(t.translateXY.y=n.ym),t.layer.style.transform="translate("+t.translateXY.x+"px,"+t.translateXY.y+"px) scale("+t._scale+")",t.lastXY.x=o.offsetX,t.lastXY.y=o.offsetY}return!1}}return t.prototype.watchrotate=function(){this.watchSrc(this.imgSrc)},t.prototype.watchSrc=function(t){var e=this,o=new Image,a=this._imgSrc;o.onload=function(){a==e._imgSrc&&e.imgSrc==t&&e.rotateImg(o.naturalWidth,o.naturalHeight,t,e.rotate).then(function(t){e._imgSrc=t.src,e.naturalImgInfo.w=t.w,e.naturalImgInfo.h=t.h,e.resize(),e.watchfocusAreas(e.focusAreas)})},o.src=t},t.prototype.watchfocusAreas=function(t){var e=this,o=t;if(null==o?o=[]:o instanceof Array||(o=[o]),!this.naturalImgInfo||null==this.naturalImgInfo.w||null==this.naturalImgInfo.h||this.naturalImgInfo.w<=0||this.naturalImgInfo.h<=0)this._focusAreas=[];else{this.orientation=this.root.offsetWidth/this.root.offsetHeight>this.naturalImgInfo.w/this.naturalImgInfo.h;var a=this.orientation?this.root.offsetHeight/this.naturalImgInfo.h*this.naturalImgInfo.w:this.root.offsetWidth,s=this.orientation?this.root.offsetHeight:this.root.offsetWidth/this.naturalImgInfo.w*this.naturalImgInfo.h,r=this.orientation?this.root.offsetHeight/this.naturalImgInfo.h:this.root.offsetWidth/this.naturalImgInfo.w,i=0,n=0;this.orientation?i=(this.root.offsetWidth-a)/2:n=(this.root.offsetHeight-s)/2,this._focusAreas=[];for(var h=function(t){l._focusAreas.push({x:function(){return t.x*r+i-(t.borderWidth?t.borderWidth:2)/e._scale+"px"},y:function(){return t.y*r+n-(t.borderWidth?t.borderWidth:2)/e._scale+"px"},width:t.width*r+"px",height:t.height*r+"px",borderColor:t.borderColor?t.borderColor:"red",borderWidth:function(){return(t.borderWidth?t.borderWidth:2)/e._scale+"px"},borderType:t.borderType?t.borderType:"solid"})},l=this,c=0,f=o;c<f.length;c++)h(f[c])}},t.prototype.calcScaleOrigin=function(t,e){return{x:t-this.translateXY.x*this._scale,y:e-this.translateXY.y*this._scale}},t.prototype.componentDidUpdate=function(){this.root=this._root.firstElementChild,this.layer=this._root.firstElementChild.firstElementChild},t.prototype.calcOffset=function(t,e,o){var a=[];a.push(this._calcSize(-t,0,0)),a.push(this._calcSize(-t,e,0)),a.push(this._calcSize(-t,0,o)),a.push(this._calcSize(-t,e,o)),console.log(a);for(var s=0,r=0,i=0,n=a;i<n.length;i++){var h=n[i];s=h.x<s?h.x:s,r=h.y<r?h.y:r}return{x:s,y:r}},t.prototype.calcSize=function(t,e,o){var a=[];a.push(this._calcSize(-t,-e/2,-o/2)),a.push(this._calcSize(-t,e/2,-o/2)),a.push(this._calcSize(-t,-e/2,o/2)),a.push(this._calcSize(-t,e/2,o/2)),console.log(a);for(var s=0,r=0,i=0,n=0,h=0,l=a;h<l.length;h++){var c=l[h];s=c.x<s?c.x:s,r=c.x>r?c.x:r,i=c.y<i?c.y:i,n=c.y>n?c.y:n}return{w:Math.abs(r-s),h:Math.abs(n-i)}},t.prototype._calcSize=function(t,e,o){var a=Math.atan2(o,e)/Math.PI*180-t,s=Math.sqrt(Math.pow(o,2)+Math.pow(e,2)),r=Math.sin(a/180*Math.PI);return{x:s*Math.cos(a/180*Math.PI),y:s*r}},rotateImg=function(t,e,o,a){var s=this;return null==a&&(a=0),new Promise(function(r){var i=new Image;i.src=o,i.onload=function(){var o=document.createElement("canvas"),n=o.getContext("2d"),h=s.calcSize(a,t,e),l=s.calcOffset(a,t,e);o.width=h.w,o.height=h.h,o.style.display="none";try{document.body.appendChild(o),n.translate(-l.x,-l.y),n.rotate(a*Math.PI/180),n.drawImage(i,0,0,t,e),r(Object.assign({src:o.toDataURL("image/png")},h))}finally{document.body.removeChild(o)}}})},t.prototype.componentDidLoad=function(){var t=this;this.root=this._root.firstElementChild,this.layer=this._root.firstElementChild.firstElementChild,this.imgSrc&&this.watchSrc(this.imgSrc),this.root.addEventListener("mousedown",this.dragStartHandler),this.root.addEventListener("mousemove",this.handleMousemove),this.root.addEventListener("mouseup",this.dragEndHandler),this.root.addEventListener("mouseleave",this.dragEndHandler),this.root.addEventListener("touchstart",this.dragStartHandler),this.root.addEventListener("touchmove",this.handleMousemove),this.root.addEventListener("touchend",this.dragEndHandler),this.root.addEventListener("touchcancel",this.dragEndHandler),this.root.addEventListener("mousewheel",function(e){return console.log(e.wheelDelta,e),e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),t.handleZoom(e),!1}),window.addEventListener("resize",this.resize)},t.prototype.componentDidUnload=function(){window.removeEventListener("resize",this.resize)},t.prototype.onImgLoad=function(){},t.prototype.calcTranslate=function(){var t,e,o,a,s=this.orientation?this.root.offsetHeight/this.naturalImgInfo.h*this.naturalImgInfo.w:this.root.offsetWidth,r=this.orientation?this.root.offsetHeight:this.root.offsetWidth/this.naturalImgInfo.w*this.naturalImgInfo.h;if(this.orientation){if(o=-(r*this._scale-this.root.offsetHeight),a=0,(t=-(this.root.offsetWidth-s)*this._scale/2)>(e=this.root.offsetWidth-((this.root.offsetWidth-s)/2+s)*this._scale)){var i=t;t=e,e=i}}else t=-(s*this._scale-this.root.offsetWidth),e=0,(o=-(this.root.offsetHeight-r)*this._scale/2)>(a=this.root.offsetHeight-((this.root.offsetHeight-r)/2+r)*this._scale)&&(i=o,o=a,a=i);return{xm:t,xa:e,ym:o,ya:a}},t.prototype.dragStart=function(t){return t.stopPropagation(),t.preventDefault(),!1},t.prototype.render=function(){return e("div",{class:"container"},e("div",{class:"painter",style:{}},e("img",{onDragStart:this.dragStart,src:this._imgSrc,style:{height:this.orientation?"100%":"auto",width:this.orientation?"auto":"100%"}}),this._focusAreas?this._focusAreas.map(function(t){return e("div",{class:"selected",style:{height:t.height,width:t.width,top:t.y(),left:t.x(),border:t.borderWidth()+" "+t.borderType+" "+t.borderColor}})}):void 0))},Object.defineProperty(t,"is",{get:function(){return"encircle-image"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"properties",{get:function(){return{_focusAreas:{state:!0},_imgSrc:{state:!0},_root:{elementRef:!0},focusAreas:{type:"Any",attr:"focus-areas",watchCallbacks:["watchfocusAreas"]},imgSrc:{type:String,attr:"img-src",watchCallbacks:["watchSrc"]},maxScale:{type:Number,attr:"max-scale"},minScale:{type:Number,attr:"min-scale"},orientation:{state:!0},rotate:{type:Number,attr:"rotate",watchCallbacks:["watchrotate"]},scaleStep:{type:Number,attr:"scale-step"}}},enumerable:!0,configurable:!0}),Object.defineProperty(t,"style",{get:function(){return"encircle-image{display:block;-webkit-box-sizing:border-box;box-sizing:border-box;contain:layout style size;overflow:hidden}encircle-image .container{height:100%;width:100%;margin:0!important;padding:0!important;border:none!important;overflow:hidden}encircle-image .painter{position:relative;overflow:hidden;pointer-events:none;width:100%;height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-transform-origin:0 0;transform-origin:0 0}encircle-image .selected{position:absolute;-webkit-box-sizing:content-box;box-sizing:content-box;border:3px solid red;pointer-events:none}encircle-image img{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:100%}"},enumerable:!0,configurable:!0}),t}();t.EncircleImage=o,Object.defineProperty(t,"__esModule",{value:!0})});